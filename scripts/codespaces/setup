#!/bin/bash

if [ -d "node_modules" ]; then
    rm -r node_modules
fi

if [ -f "package-lock.json" ]; then
    rm package-lock.json
fi

npm install

SFDX_PLUGINS=$(cat ./config/dev-config.json | jq -r '.sfdxPlugins[]')
mkdir -p $HOME/.config/sfdx
pushd .
cd $HOME/.config/sfdx
echo $SFDX_PLUGINS | jq -R -s -c 'split("\n")[:-1]' > unsignedPluginAllowList.json
popd
echo "$SFDX_PLUGINS"
sfdx plugins:install $SFDX_PLUGINS

npm install --save-dev prettier prettier-plugin-apex lint-staged husky

exit