## Setup Guide
1. Enable DevHub in your production org.
2. Create a connected app in your production org for the octoforce CI/CD application that will be provisioning sandboxes and deploying to production.
    - create [private key and cert](https://developer.salesforce.com/docs/atlas.en-us.sfdx_dev.meta/sfdx_dev/sfdx_dev_auth_key_and_cert.htm)
    - grant appropriate permissions/policies
    - grant the "system administrator" or any other profiles access to the new connected app
3. Clone your production org to create a sandbox named "template".  This is the org that will be cloned to create your dev and uat sandboxes.
4. Update the connected app in your template sandbox.
    - upload your cert (you can use the same one as your production org or generate a new key/cert pair)
    - grant appropriate permissions/policies
    - grant the "system administrator" or any other profiles access to the new connected app
6. Generate age public/private keys and set the SFDX_AUTH_SECRET_KEY secret.
7. Create a PAT with "repo" scope and store its value as a secret in your repo with the key "SCOPED_PAT"
8. 

## Required Configurations

### Secrets

The following secrets are required to be set in the repository settings:

- `SCOPED_PAT`
  - This is a personal access token with the `repo` scope. This is used to checkout the repository and push any changes.
- `SALESFORCE_JWT_KEY`
  - This is the private key used to generate the JWT token. This is used to authenticate with Salesforce production.
- `SALESFORCE_CLIENT_ID`
  - This is the client ID used to generate the JWT token. This is used to authenticate with Salesforce production.
- `SALESFORCE_DEVHUB_USERNAME`
  - This is the username of the DevHub org. This is used to authenticate with Salesforce production.
- `SALESFORCE_TEMPLATE_CONSUMER_KEY`
  - This is the consumer key of the template org. This is used to authenticate with the template sandbox.
- `SALESFORCE_TEMPLATE_USERNAME`
  - This is the username of the template org. This is used to authenticate with the template sandbox.
- `SALESFORCE_TEMPLATE_JWT_SECRET_KEY`
  - This is the private key used to generate the JWT token. This is used to authenticate with the template sandbox.
- `BOT_USER_EMAIL`
  - This is the email of the bot user. This is used to create pull requests against the main branch.
- `BOT_USER_NAME`
  - This is the name of the bot user. This is used to create pull requests against the main branch.
- `SFDX_AUTH_SECRET_KEY`
  - This is the age private key used to encrypt sfdx auth URLs. The encrypted sfdx auth URLs are required to deploy pull requests to UAT sandboxes and are generated by running `scripts/sandbox_auth`. Please see [SFDX Auth URLs & Encryption.md](SFDX%20Auth%20URLs%20%26%20Encryption.md) for more information.
### Repository Variables

The following repository variables are required to be set in the repository settings:

- `ISSUE_BRANCH_PREFIX`
  - This is the prefix used for the issue branch. This is used to identify branches that require a sandbox.
- `RELEASE_BRANCH_PREFIX`
  - This is the prefix used for the release branch. This is used to identify branches where pull requests should be deployed to test sandbox.
- `GENERATE_RELEASE`
  - This is feature flag that is a boolean value that determines whether release notes should be generated.
- `SALESFORCE_FORMATTED_PROFILES_AND_PERMS`
  - This is a feature flag that is a boolean value that determines whether profiles and permissions should be formatted using the `profile:decompose` plugin.
- `DEPLOYMENT_TIMEOUT`
  - The number of minutes to wait for the `force:source:deploy` command to complete and display results.
